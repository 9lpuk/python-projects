import cv2
import numpy as np
import os
def load_image(filename="img.jpeg"):
    """
    –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
    –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±–æ–π –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
    """
    # –ü–æ–ª—É—á–∞–µ–º –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞
    script_dir = os.path.dirname(os.path.abspath(__file__))
    
    # –í–∞—Ä–∏–∞–Ω—Ç—ã –ø—É—Ç–µ–π –¥–ª—è –ø–æ–∏—Å–∫–∞ (–æ—Ç –Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–æ–≥–æ –∫ –º–µ–Ω–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–æ–º—É)
    search_paths = [
        os.path.join(script_dir, filename),           # –í —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ —á—Ç–æ –∏ —Å–∫—Ä–∏–ø—Ç
        os.path.join(script_dir, "images", filename), # –í –ø–∞–ø–∫–µ images —Ä—è–¥–æ–º —Å–æ —Å–∫—Ä–∏–ø—Ç–æ–º
        os.path.join(script_dir, "data", filename),   # –í –ø–∞–ø–∫–µ data —Ä—è–¥–æ–º —Å–æ —Å–∫—Ä–∏–ø—Ç–æ–º
        os.path.join(script_dir, "..", filename),     # –ù–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ
        filename,                                     # –í —Ç–µ–∫—É—â–µ–π —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    ]
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏
    for path in search_paths:
        if os.path.exists(path):
            img = cv2.imread(path)
            if img is not None:
                print(f"‚úì –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: {path}")
                return img
            else:
                print(f"‚úó –§–∞–π–ª –Ω–∞–π–¥–µ–Ω, –Ω–æ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω: {path}")
    # –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—à–ª–∏
    print(f"‚úó –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ '{filename}' –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –º–µ—Å—Ç–∞—Ö:")
    for path in search_paths:
        print(f"  - {path}")

    return None

def imshow(img, window_name="Image"):             
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –æ–∫–Ω–µ
    """
    if img is None:
        print('–û—à–∏–±–∫–∞: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ')
    else:
        cv2.namedWindow(window_name, cv2.WINDOW_NORMAL)
        cv2.imshow(window_name, img)
        cv2.waitKey(0)
        cv2.destroyAllWindows()

# =========== –û–°–ù–û–í–ù–û–ô –ö–û–î ===========
if __name__ == "__main__":
    print("=" * 50)
    print("–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...")
    print("=" * 50)
    
    # 1. –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    # –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å "img.jpeg" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    img = load_image("img.jpeg")
    
    # 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    if img is not None:
        print("–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ò:")
        
        # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        print(f"–†–∞–∑–º–µ—Ä—ã (–≤—ã—Å–æ—Ç–∞, —à–∏—Ä–∏–Ω–∞, –∫–∞–Ω–∞–ª—ã): {img.shape}")
        print(f"–í—ã—Å–æ—Ç–∞: {img.shape[0]} –ø–∏–∫—Å–µ–ª–µ–π")
        print(f"–®–∏—Ä–∏–Ω–∞: {img.shape[1]} –ø–∏–∫—Å–µ–ª–µ–π")
        
        if len(img.shape) == 3:
            print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–∞–ª–æ–≤: {img.shape[2]} (—Ü–≤–µ—Ç–Ω–æ–µ BGR)")
        else:
            print("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–∞–ª–æ–≤: 1 (—á–µ—Ä–Ω–æ-–±–µ–ª–æ–µ)")
        
        # 3. –ö–∞–¥—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø—Ä–∏–º–µ—Ä)
        print("\n–ö–∞–¥—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...")
        
        # –ë–µ—Ä–µ–º —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É—é —á–∞—Å—Ç—å (–ø—Ä–∏–º–µ—Ä –∫–∞–¥—Ä–∏—Ä–æ–≤–∞–Ω–∏—è)
        height, width = img.shape[:2]
        
        # –í—ã—á–∏—Å–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –∫–∞–¥—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ (80% –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞)
        crop_height = int(height * 0.8)
        crop_width = int(width * 0.8)
        start_y = (height - crop_height) // 2
        start_x = (width - crop_width) // 2
        
        #  —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã 
        cropped = img[1:150, 1:330]  

        
        print(f"–†–∞–∑–º–µ—Ä –ø–æ—Å–ª–µ –∫–∞–¥—Ä–∏—Ä–æ–≤–∞–Ω–∏—è: {cropped.shape}")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        imshow(img, "Original")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–¥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        imshow(cropped, "Cut")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–¥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        output_path = os.path.join(os.path.dirname(os.path.abspath(__file__)), "cropped_image.jpg")
        cv2.imwrite(output_path, cropped)
        print(f"‚úì –ö–∞–¥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: {output_path}")
        
    else:

        print("–ü–†–û–ë–õ–ï–ú–ê –° –ó–ê–ì–†–£–ó–ö–û–ô –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø")

        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
        script_dir = os.path.dirname(os.path.abspath(__file__))
        print(f"–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–∫—Ä–∏–ø—Ç–∞: {script_dir}")
        print(f"\n–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞:")
        
        try:
            items = os.listdir(script_dir)
            for item in items:
                item_path = os.path.join(script_dir, item)
                if os.path.isfile(item_path):
                    print(f"  üìÑ {item}")
                else:
                    print(f"  üìÅ {item}/")
        except Exception as e:
            print(f"  –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: {e}")
        
        print(f"\n–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:")
        print(f"1. –ü–æ–º–µ—Å—Ç–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (img.jpeg, img.jpg –∏ —Ç.–¥.) –≤ –ø–∞–ø–∫—É: {script_dir}")
        print(f"2. –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É 'images' –≤ —ç—Ç–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ –ø–æ–º–µ—Å—Ç–∏—Ç–µ —Ç—É–¥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ")
        
        # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É images –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
        images_dir = os.path.join(script_dir, "images")
        os.makedirs(images_dir, exist_ok=True)
        print(f"‚úì –ü–∞–ø–∫–∞ 'images' —Å–æ–∑–¥–∞–Ω–∞: {images_dir}")
if filename == True:
    break
